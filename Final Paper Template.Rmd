---
title: "Your Paper Title Here"
author: "Your Name(s)"
date: Date
output: pdf_document
urlcolor: blue
header-includes:
- \usepackage{amsmath,amsfonts,amssymb}
- \usepackage{setspace} \doublespacing
fontsize: 11pt
---

```{r setup, include=FALSE, warning=FALSE, echo = FALSE}
#Use this code chunk to include libraries, and set global options.
library(ggplot2)
library(HDInterval)
library(dplyr)
library(binom)
knitr::opts_chunk$set(
  echo = FALSE,      # show code in the output
  warning = FALSE,  # hide warnings
  message = FALSE   # hide messages
)
```

# Abstract
Write your abstract here.

***TESTTTING****

# Keywords
*Keyword 1*, *Keyword 2*, *Keyword 3*, *Keyword 4*

\newpage

# Introduction / Background
\section*{Introduction}
The COVID-19 pandemic, caused by the coronavirus SARS-CoV-2, has had a massive global impact since it first emerged in late 2019, affecting health, economies, and daily life worldwide. Developing safe and effective vaccines quickly became crucial to help curb the spread and reduce severe illness. One of the earliest breakthroughs was the mRNA-based BNT162b2 vaccine from Pfizer and BioNTech, which showed impressive efficacy in clinical trials (Polack et al., 2021). By December 2020, the U.S. Food and Drug Administration (FDA) granted Emergency Use Authorization (EUA) for BNT162b2 (FDA, 2020)â€”a major turning point in fighting the pandemic. This authorization was supported by data from a phase 2/3 randomized, placebo-controlled trial involving over 34,000 participants, which reported a 95\% vaccine efficacy (VE) against symptomatic COVID-19 (Polack et al., 2021).

Vaccine efficacy trials rely on rigorous statistical frameworks to evaluate the reduction in disease risk between vaccinated and unvaccinated groups. Traditional frequentist methods, such as confidence intervals and p-values, have long dominated clinical trial analyses. However, Bayesian approaches are increasingly employed for their ability to incorporate prior evidence and provide probabilistic interpretations of efficacy (Berry et al., 2006). The original BNT162b2 trial used a Bayesian beta-binomial model with a Beta(0.700102, 1) prior to estimate VE, defined as 

\begin{equation}
\psi = \frac{1-2\pi}{1-\pi}
\end{equation}
where \(\pi\) represents the probability of infection in the vaccine group relative to placebo (Polack, et al., 2021). This analysis yielded a posterior median VE of 95\% (95\% credible interval: 90.3--97.6\%) and a $>$99.99\% posterior probability that VE exceeded 30\%. These results aligned with findings from other mRNA vaccines like Moderna's mRNA-1273 (Baden et al., 2021).

Despite the strong evidence presented by the original Bayesian analysis, comparing Bayesian and frequentist methodologies offers unique insights. Frequentist methods, which avoid prior distributions and focus on long-run frequency, remain the regulatory standard for many trials (FDA, 2020). A double analysis could strengthen our confidence in the results by examining similarities and differences between the two frameworks, particularly in estimating uncertainty intervals. For instance, while Bayesian credible intervals reflect posterior probability, frequentist confidence intervals rely on repeated sampling interpretations---a distinction with practical implications for interpretation (Wasserstein at al., 2019).

WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!! WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!WE NEED TO ADD A TABLE OF THE ORIGINAL DATA HERE!!!!

The present study reanalyzes these data Table 1 using both Bayesian and frequentist approaches. The primary goals are to: (1) estimate VE and associated uncertainty under each framework, (2) compare the resulting efficacy point and interval estimates, and (3) evaluate the posterior probability (Bayesian) and p-values (frequentist) for the hypothesis that VE exceeds 30\%. Our hypotheses are as follows:
\\

\noindent\textbf{Hypotheses:}
\begin{itemize}
\item Both frameworks will confirm high VE ($>$90\%) for BNT162b2
\item Uncertainty intervals will differ modestly between methods
\item Both analyses will reject the null hypothesis (VE $\leq$ 30\%) with overwhelming evidence
\end{itemize}

This comparative analysis not only reinforces confidence in BNT162b2's efficacy but also highlights the complementary strengths of Bayesian and frequentist statistics in public health research.

```{r label="important_R_code", eval=TRUE, echo=FALSE}
# You can reference your code in the appendix (sample here).
```

```{r}
# Summary data from the paper:
# For participants without evidence of infection:
# Group       Cases    SampleSize
# BNT162b2      8       17,411
# Placebo     162       17,511

data <- data.frame(
  Group = c("BNT162b2", "Placebo"),
  Cases = c(8, 162),
  SampleSize = c(17411, 17511)
)

# Calculate incidence rate per 1000 participants:
data <- data %>%
  mutate(IncidenceRate = Cases / SampleSize * 1000)

# Calculate exact binomial 95% confidence intervals for the incidence rates
ci <- binom.confint(data$Cases, data$SampleSize, methods = "exact")
data$Lower <- ci$lower * 1000
data$Upper <- ci$upper * 1000

# Create the bar plot
ggplot(data, aes(x = Group, y = IncidenceRate, fill = Group)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_errorbar(aes(ymin = Lower, ymax = Upper), width = 0.2) +
  labs(title = "Incidence Rate of Covid-19 Cases (per 1000 participants)",
       y = "Incidence Rate (per 1000)",
       x = "Group") +
  theme_minimal() +
  theme(legend.position = "none")

```
```{r}
# Calculate attack rates:
attack_rate_vaccine <- 8 / 17411
attack_rate_placebo <- 162 / 17511

# Vaccine efficacy (VE) is defined as 1 - (attack rate in vaccine group) / (attack rate in placebo group)
VE <- 1 - attack_rate_vaccine / attack_rate_placebo
VE_percent <- round(VE * 100, 2)

cat("Estimated Vaccine Efficacy (VE):", VE_percent, "%\n")

```

# Statistical Methods

## Model
Describe the statistical model used.

## Likelihood Inference
Detail the likelihood approach.

#likihood function:

#MLE

#Confidence Interval for Phi

  #Large sample confidence interval
  
  #Bootstrap
  
```{r, echo= FALSE}
B= 100
set.seed(123)
n <- 160
boot_df <- replicate ( n = B, expr= (rbinom(n = 1,size = n, prob = 8/170)))
psi <- numeric(B)
for (i in 1:B){
  Tvar <- boot_df[i]
  psi[i] <- ((n-(2*Tvar)) / (n-Tvar) )
}                       

result <- quantile(psi, probs = c(0.025, 0.975))

# Print the result
print(result)

```
  

## Bayesian Inference
Detail the Bayesian approach.


# Results
Present your findings.
#beta binomial model
$T_{\pi} \sim Binom(170,\pi)$
$g(\pi) = Beta(a,b)$

$P(\psi\geq 0.3) = P(\frac{1-2\pi}{1-\pi} \geq 0.3)$
$=P(\pi \leq \frac{7}{17})$
$=\frac{7}{17}$

#priors
We will use the following priors

experimental prior
$P(\psi \geq 0.3) \approx 0.57$
$P(\psi \geq 0) = 1$

0.05 prior
$P(\psi \geq 0.3) = 0.05$
$P(\psi \geq 0) = 0.5$

0.01 prior
$P(\psi \geq 0.3) = 0.01$
$P(\psi \geq 0) = 0.5$

The experimental prior is the prior that Pfizer used in their study, which gives the vaccine the best chance of passing the tests. The following two priors have a decreasing chance of passing the tests.



#betas

```{r, echo = FALSE}
library(LearnBayes)
prior1Beta <- beta.select(quantile1 = list(p=0.05, x = 7/17),
            quantile2 = list(p = 0.5, x = 0.5))
prior2Beta <- beta.select(quantile1 = list(p=0.01, x = 7/17),
            quantile2 = list(p = 0.5, x = 0.5))
```

The Pfizer study used $Beta(0.700102,1)$ as their prior Betas.
We will be trying $Beta($`r round(prior1Beta,4)`$)$ and $Beta($`r round(prior2Beta,4)`$)$ as our prior Beta values.

We can visualize how much more likely their prior is than ours
  
```{r, echo = FALSE}

ggplot() +
geom_function(fun = dbeta,
mapping = aes(color = "Pfizer"),
args = list(shape1 = 0.700102, shape2 = 1),
xlim = c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "prior1"),
args = list(shape1 = 43.04, shape2 = 43.04),
xlim=c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "prior2"),
args = list(shape1 = 85.63, shape2 = 85.63),
xlim=c(0,1)) +
scale_color_manual(name = "dist", 
                   values = c("Pfizer" = "blue", "prior1" = "red", "prior2" = "black"))+
labs(title = "Prior of experiment and new pirors",
x=expression(pi),
y = "PDF")
```

So, the posterior distributions are as follows:
Pfizer: $h(\pi|t) = Beta($ `r 0.700102 + 8`, `r 162+1`$)$
0.05 posterior: $h(\pi|t) = Beta($ `r round(prior1Beta[1],4) + 8`, `r 162+round(prior1Beta[1],4)`$)$
0.01 posterior: $h(\pi|t) = Beta($ `r round(prior2Beta[1],4) + 8`, `r 162+round(prior2Beta[1],4)`$)$

We can visualize the comparison between all of the priors and posteriors:

```{r}

ggplot() +
geom_function(fun = dbeta,
mapping = aes(color = "Pfizer"),
args = list(shape1 = 0.700102, shape2 = 1),
xlim = c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "Pfizer"),
args = list(shape1 = 0.700102 + 8, shape2 = 162 + 1),
xlim=c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "0.05"),
args = list(shape1 = 43.04, shape2 = 43.04),
xlim = c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "0.05"),
args = list(shape1 = 43.04 + 8, shape2 = 162 + 43.04),
xlim=c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "0.01"),
args = list(shape1 = 85.63, shape2 = 85.63),
xlim = c(0,1)) +
geom_function(fun = dbeta,
mapping = aes(color = "0.01"),
args = list(shape1 = 85.63 + 8, shape2 = 162 + 85.63),
xlim=c(0,1)) +
scale_color_manual(name = "dist", 
                   values = c("Pfizer" = "blue", "0.05" = "red", "0.01" = "black"))+
labs(title = "Priors and Posteriors",
x=expression(pi),
y = "PDF")


```


summarizing the posterior distribution of $\pi$

```{r, echo = FALSE, eval = FALSE}
# Pfizer Posterior
pfizer_shape1 <- 0.700102 + 8
pfizer_shape2 <- 162 + 1
pfizer_median <- qbeta(0.5, shape1 = pfizer_shape1, shape2 = pfizer_shape2)
pfizer_ci <- qbeta(c(0.025, 0.975), shape1 = pfizer_shape1, shape2 = pfizer_shape2)

# 0.05 Prior Posterior
prior1_shape1 <- prior1Beta + 8
prior1_shape2 <- 162 + prior1Beta
prior1_median <- qbeta(0.5, shape1 = prior1_shape1, shape2 = prior1_shape2)
prior1_ci <- qbeta(c(0.025, 0.975), shape1 = prior1_shape1, shape2 = prior1_shape2)

# 0.01 Prior Posterior
prior2_shape1 <- prior2Beta + 8
prior2_shape2 <- 162 + prior2Beta
prior2_median <- qbeta(0.5, shape1 = prior2_shape1, shape2 = prior2_shape2)
prior2_ci <- qbeta(c(0.025, 0.975), shape1 = prior2_shape1, shape2 = prior2_shape2)

cat("Pfizer posterior median:", round(pfizer_median, 4), "\n")
cat("95% CI for Pfizer: [", round(pfizer_ci[1], 4), ",", round(pfizer_ci[2], 4), "]\n\n")

cat("0.05 prior posterior median:", round(prior1_median, 4), "\n")
cat("95% CI for 0.05 prior: [", round(prior1_ci[1], 4), ",", round(prior1_ci[2], 4), "]\n\n")

cat("0.01 prior posterior median:", round(prior2_median, 4), "\n")
cat("95% CI for 0.01 prior: [", round(prior2_ci[1], 4), ",", round(prior2_ci[2], 4), "]\n")


```
Now we can do some confidence tests to see the significance of our estimates.
  
## Significance Tests and Posterior Distributions

The Pfizer study used a $\text{Beta}(0.700102,1)$ prior. In our analysis, we compare this with two alternative prior distributions:
$$
\text{Beta}\Bigl(\text{Prior 1: } \text{Beta}\Bigl(`r round(prior1Beta[1],4)`,\, `r round(prior1Beta[1],4)`\Bigr) \Bigr)
\quad \text{and} \quad
\text{Beta}\Bigl(\text{Prior 2: } \text{Beta}\Bigl(`r round(prior2Beta[1],4)`,\, `r round(prior2Beta[1],4)`\Bigr) \Bigr).
$$

Given the data (with 8 successes and 162 failures), the posterior distributions are updated as follows:

- **Pfizer Posterior:**
$$
h(\pi\mid t) = \text{Beta}\Bigl(0.700102 + 8,\, 162 + 1\Bigr)
$$

- **0.05 Prior Posterior:**
$$
h(\pi\mid t) = \text{Beta}\Bigl(`r round(prior1Beta[1],4)` + 8,\, 162 + `r round(prior1Beta[1],4)`\Bigr)
$$

- **0.01 Prior Posterior:**
$$
h(\pi\mid t) = \text{Beta}\Bigl(`r round(prior2Beta[1],4)` + 8,\, 162 + `r round(prior2Beta[1],4)`\Bigr)
$$

Below we compute the posterior medians and approximate 95\% credible intervals (using the 2.5th and 97.5th percentiles):

- **Pfizer Posterior:**

  Posterior median: $\approx `r round(qbeta(0.5, 0.700102 + 8, 162 + 1), 4)`$

  95\% CI: $\Bigl[ `r round(qbeta(0.025, 0.700102 + 8, 162 + 1), 4)`,\; `r round(qbeta(0.975, 0.700102 + 8, 162 + 1), 4)` \Bigr]$

- **0.05 Prior Posterior:**

  Posterior median: $\approx `r round(qbeta(0.5, prior1Beta[1] + 8, 162 + prior1Beta[1]), 4)`$

  95\% CI: $\Bigl[ `r round(qbeta(0.025, prior1Beta[1] + 8, 162 + prior1Beta[1]), 4)`,\; `r round(qbeta(0.975, prior1Beta[1] + 8, 162 + prior1Beta[1]), 4)` \Bigr]$

- **0.01 Prior Posterior:**

  Posterior median: $\approx `r round(qbeta(0.5, prior2Beta[1] + 8, 162 + prior2Beta[1]), 4)`$

  95\% CI: $\Bigl[ `r round(qbeta(0.025, prior2Beta[1] + 8, 162 + prior2Beta[1]), 4)`,\; `r round(qbeta(0.975, prior2Beta[1] + 8, 162 + prior2Beta[1]), 4)` \Bigr]$
\section*{Hypothesis Tests}

We test the hypothesis for vaccine effectiveness:
\[
H_0: \pi \ge 0.5 \quad \text{vs} \quad H_1: \pi < 0.5.
\]

For each posterior distribution, the p-value is computed as the probability of observing 
\(\pi \ge 0.5\) under the posterior, i.e.,
\[
p\text{-value} = 1 - F(0.5),
\]
where \(F(\beta)\) is the cumulative distribution function of the corresponding Beta posterior.

\textbf{Pfizer Posterior:}
\[
p\text{-value} \approx `r round(1 - pbeta(0.5, 0.700102 + 8, 162 + 1), 4)`.
\]

\textbf{0.05 Prior Posterior:}
\[
p\text{-value} \approx `r round(1 - pbeta(0.5, prior1Beta[1] + 8, 162 + prior1Beta[1]), 4)`.
\]

\textbf{0.01 Prior Posterior:}
\[
p\text{-value} \approx `r round(1 - pbeta(0.5, prior2Beta[1] + 8, 162 + prior2Beta[1]), 4)`.
\]



 

# Discussion / Conclusion
Discuss / conclude here.

# Bibliography

Baden, L.R., et al. (2021). \textit{N. Engl. J. Med.}, 384(5), 403â€“416.

Berry, D.A. (2006). \textit{Nature}, 440(7088), 1078â€“1083.

U.S. Food \& Drug Administration (2020). Emergency Use Authorization for Pfizer-BioNTech COVID-19 Vaccine.

Polack, F.P., et al. (2020). \textit{N. Engl. J. Med.}, 383(27), 2603â€“2615.

Wasserstein, R.L., et al. (2019). \textit{Am. Stat.}, 73(sup1), 1â€“19.

# Appendix

## Code
```{r ref.label = "important_R_code", eval=FALSE}
```

```{r ref.label = "psi_dist", eval=FALSE }
psi_dist <- function(x, shape1, shape2){
  pi <- (x-1)/(x-2)
  return(dbeta(x = pi, shape1 = shape1, shape2 = shape2))
}
```

## Proofs
If applicable, include detailed mathematical derivations or additional theoretical explanations.

Proof of the Maximum Likelihood Estimator for $\widehat{\psi}_0^{mle}$:

We can begin with the Likelihood function. Recall that the design of our experiment is binomial; we observe 170 infections and try to make inference on $\pi$, the proportion of infections from those who have the vaccine. Assuming each observation is independent (which is necessary for a binomial model), we can write our likelihood function in terms of $\pi$:
$$L(\pi) = \binom{170}{x}(\pi)^x(1-\pi)^{170-x}$$
Where $x$ is the observed number of infections where the patient had the vaccine. We observe $x = 8$, so we can rewrite our likelihood function:
$$L(\pi; x = 8) = \binom{170}{8}(\pi)^8(1-\pi)^{162}$$
Notably, however, we are not hoping to draw inference on $\pi$, but rather on $\psi$, the efficacy of the vaccine. We can write this parameter in terms of $\pi$.
$$\psi = \frac{1-2\pi}{1-\pi}$$
In order to write our Likelihood function in terms of $\psi$, we can rewrite $\psi$ in terms of $\pi$:
$$\pi = \frac{\psi - 1}{\psi -2}$$
Now we rewrite our likelihood function.
$$L^*(\psi) = \binom{170}{8}\left(\frac{\psi-1}{\psi-2}\right)^8\left(\frac{-1}{\psi-2}\right)^{162}$$
Now that we have written our full likelihood function in terms of $\psi$, we can write the log likelihood function.
$$\ell^*(\psi) = \log\binom{170}{8}+8\log(\psi-1)-8\log(\psi-2)-162\log(\psi-2) +162\log(-1)$$
We have $162\log(-1) = \log((-1)^{162}) = \log(1) = 0$:
$$\ell^*(\psi) =  \log\binom{170}{8}+8\log(\psi-1)-170\log(\psi-2)$$
To maximize this equation, we take its derivative with respect to $\psi$:
$$\frac{d}{d\psi}\ell^*(\psi) = \frac{8}{\psi-1} - \frac{170}{\psi-2}$$
Setting this derivative finds the maximum:
$$0 = \frac{8}{\hat{\psi}_0^{mle} - 1} - \frac{170}{\hat{\psi}_0^{mle}-2}$$
$$\frac{170}{\hat{\psi}_0^{mle}-2} = \frac{8}{\hat{\psi}_0^{mle}-1}$$
$$170\hat{\psi}_0^{mle} - 170 = 8\hat{\psi}_0^{mle} - 16$$
$$\hat{\psi}_0^{mle} = \frac{154}{162}$$

The Fisher information is the negative expectation of the second derivative of the log-likelihood. So for $X \sim \text{Binomial}(n, \pi)$,

\[
I(\psi) = \mathbb{E}\left[-\frac{d^2\ell}{d\psi^2}\right] = \frac{\mathbb{E}[X]}{(1 - \psi)^2} - \frac{n}{(2 - \psi)^2}.
\]

Substituting $\mathbb{E}[X] = n\pi = n \cdot \frac{1 - \psi}{2 - \psi}$,

\[
I(\psi) = \frac{n(1 - \psi)}{(2 - \psi)(1 - \psi)^2} - \frac{n}{(2 - \psi)^2} = \frac{n}{(2 - \psi)(1 - \psi)} - \frac{n}{(2 - \psi)^2}.
\]

Factoring out $\frac{n}{2 - \psi}$,

\[
I(\psi) = \frac{n}{2 - \psi} \left(\frac{1}{1 - \psi} - \frac{1}{2 - \psi}\right).
\]

Combining terms with a common denominator,

\[
I(\psi) = \frac{n}{2 - \psi} \cdot \frac{(2 - \psi) - (1 - \psi)}{(1 - \psi)(2 - \psi)} = \frac{n}{(1 - \psi)(2 - \psi)^2}.
\]

So we get 
\[
I(\psi) = \frac{n}{(1 - \psi)(2 - \psi)^2}.
\]

We know that \[
\widehat{SE} = \frac{1}{\sqrt{n I(\hat{\psi})}}
\]

and that our large sample confidence interval is given by \[
\hat{\psi}^{mle} \pm z_{\alpha/2}\cdot \widehat{SE}\]
